# Unbound Configuration for Pi-hole
# Guía completa: https://www.eldiarioia.es/pi-hole-bloqueador-dns-homelab
# Basado en: https://docs.pi-hole.net/guides/dns/unbound/

server:
    # Logging (reducido para mejor rendimiento)
    verbosity: 0
    
    # Interfaces
    interface: 0.0.0.0
    port: 5335
    do-ip4: yes
    do-udp: yes
    do-tcp: yes
    
    # IPv6 (desactivado por defecto)
    do-ip6: no
    prefer-ip6: no
    
    # Seguridad
    harden-glue: yes
    harden-dnssec-stripped: yes
    harden-algo-downgrade: yes
    harden-below-nxdomain: yes
    
    # Evitar DNS rebinding attacks
    private-address: 192.168.0.0/16
    private-address: 169.254.0.0/16
    private-address: 172.16.0.0/12
    private-address: 10.0.0.0/8
    private-address: fd00::/8
    private-address: fe80::/10
    
    # Minimización de consultas (privacidad)
    qname-minimisation: yes
    aggressive-nsec: yes
    
    # Evitar problemas con EDNS
    edns-buffer-size: 1472
    
    # No usar CAPS para validación (puede causar problemas)
    use-caps-for-id: no
    
    # Cache
    cache-min-ttl: 3600
    cache-max-ttl: 86400
    prefetch: yes
    prefetch-key: yes
    
    # Threads y rendimiento
    num-threads: 2
    msg-cache-slabs: 4
    rrset-cache-slabs: 4
    infra-cache-slabs: 4
    key-cache-slabs: 4
    
    # Tamaño de cache
    rrset-cache-size: 64m
    msg-cache-size: 32m
    
    # Control de acceso
    access-control: 127.0.0.0/8 allow
    access-control: 172.20.0.0/24 allow
    access-control: 192.168.0.0/16 allow
    access-control: 10.0.0.0/8 allow
    
    # Root hints (descarga actualizada)
    root-hints: /opt/unbound/etc/unbound/root.hints
    
    # Trust anchor para DNSSEC
    auto-trust-anchor-file: /opt/unbound/etc/unbound/root.key
    
    # Log solo errores
    logfile: ""
    log-queries: no
    log-replies: no
    log-tag-queryreply: no
    log-local-actions: no


